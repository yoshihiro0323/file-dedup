# file-dedup

ファイルの重複を検出し、削除候補を提案するmacOS用のツールです。

## 概要

このツールは、SHA256ハッシュ値が記録されたCSVファイルを入力として、重複するファイルを検出し、削除候補を提案します。
ファイル名の長さを基準に、最も短い名前のファイルを保持し、他のファイルを削除候補として提案します。

## 使用方法

はじめに、以下のコマンドを実行してそれぞれのファイルのハッシュ値を取得し、csvファイルを作成します。
なお、実行時間を表示するため、Pipe Viewerを使用しています。
Homebrewを使って以下のようにインストールできます。
```bash
brew install pv
```

```bash
find . -type f -print0 | tee >(pv -l -s $(find . -type f | wc -l) > /dev/null) | xargs -0 sha256sum | awk -F'  ' 'BEGIN {OFS=","} {gsub(/"/, "\"\"", $2); print "\"" $2 "\",\"" $1 "\""}' > hashes.csv
```

```bash
./file-dedup -csv <CSVファイルのパス> [-out <出力ファイル名>] [-debug]
```
 
このスクリプトを実行後、ターミナルコマンドでファイルを削除できます。
削除前に本スクリプトの-debugオプションで削除されるファイルが正しいか確認してください。
```bash
pv -l duplicates.txt | while read file; do
    rm "$file"
    echo "削除完了: $file"
done
```
### オプション

- `-csv`: 必須。重複チェックするCSVファイルのパス
- `-out`: 任意。出力ファイルの名前（デフォルト: duplicates.txt）
- `-debug`: 任意。詳細な出力を行うモード

### 入力CSVファイルの形式

CSVファイルは以下の形式である必要があります：
- ヘッダーなし
- 1列目: ファイル名
- 2列目: SHA256ハッシュ値

### 出力形式

#### 通常モード
削除候補のファイルパスのみが出力されます。

#### デバッグモード
以下の形式で出力されます：
```
保持するファイル: [ファイルパス]
削除候補:
  [ファイルパス1]
  [ファイルパス2]
---
```

## 動作ロジック

1. 入力CSVファイルから、同一ハッシュ値を持つファイルをグループ化
2. 各グループ内で、以下の優先順位でファイルを選択：
   - 手動で名付けられたファイルを優先（例：`旅行写真2023.jpg`）
   - カメラの自動生成ファイル名（`DSC`、`IMG`で始まるもの）は後順位（`createFileGroup()` > `isAutoGenerated()` > `patterns`からカスタマイズできます） 
   - 同じカテゴリ内では、最も短いファイル名のファイルを選択
3. 選択されたファイルを保持対象とし、その他のファイルを削除候補として出力